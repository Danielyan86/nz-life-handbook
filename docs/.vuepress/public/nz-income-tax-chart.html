<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°è¥¿å…°æ”¶å…¥ç¨æ”¶æ€§ä»·æ¯”åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 10px;
            font-size: 32px;
        }
        .subtitle {
            text-align: center;
            color: #a0a0a0;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .chart-card {
            background: #fff;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-container {
            position: relative;
            height: 350px;
        }
        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .insight-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 25px;
            color: white;
        }
        .insight-card.green {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        .insight-card.orange {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .insight-card.blue {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .insight-card h3 {
            font-size: 16px;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        .insight-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .insight-desc {
            font-size: 14px;
            opacity: 0.85;
            line-height: 1.5;
        }
        .sweet-zones {
            background: #fff;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .sweet-zones h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
        }
        .zone {
            display: flex;
            align-items: stretch;
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .zone-indicator {
            width: 8px;
            flex-shrink: 0;
        }
        .zone-content {
            flex: 1;
            padding: 20px;
            background: #f8f9fa;
        }
        .zone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .zone-range {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        .zone-rate {
            font-size: 24px;
            font-weight: 700;
        }
        .zone-detail {
            color: #666;
            font-size: 14px;
        }
        .zone.excellent .zone-indicator { background: #10b981; }
        .zone.excellent .zone-rate { color: #10b981; }
        .zone.good .zone-indicator { background: #3b82f6; }
        .zone.good .zone-rate { color: #3b82f6; }
        .zone.medium .zone-indicator { background: #f59e0b; }
        .zone.medium .zone-rate { color: #f59e0b; }
        .zone.high .zone-indicator { background: #ef4444; }
        .zone.high .zone-rate { color: #ef4444; }
        .zone.highest .zone-indicator { background: #991b1b; }
        .zone.highest .zone-rate { color: #991b1b; }

        .calculator {
            background: #fff;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .calculator h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
        }
        .calc-input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .calc-input-group input {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            transition: border-color 0.3s;
        }
        .calc-input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .calc-input-group button {
            padding: 15px 30px;
            font-size: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .calc-input-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .calc-result {
            display: none;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 25px;
        }
        .calc-result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        .calc-result-item {
            text-align: center;
        }
        .calc-result-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .calc-result-value {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }
        .calc-result-value.green { color: #10b981; }
        .calc-result-value.red { color: #ef4444; }
        .calc-result-value.blue { color: #3b82f6; }

        .comparison-bar {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        .bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #666;
        }
        .bar-container {
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            display: flex;
        }
        .bar-net {
            background: linear-gradient(90deg, #10b981, #34d399);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }
        .bar-tax {
            background: linear-gradient(90deg, #ef4444, #f87171);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        .source {
            text-align: center;
            color: #666;
            font-size: 12px;
            padding: 20px;
        }
        .source a {
            color: #667eea;
        }

        .key-point {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
            padding: 20px;
            border-radius: 0 12px 12px 0;
            margin: 20px 0;
        }
        .key-point h4 {
            color: #92400e;
            margin-bottom: 10px;
        }
        .key-point p {
            color: #78350f;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ–°è¥¿å…°æ”¶å…¥ç¨æ”¶æ€§ä»·æ¯”åˆ†æ</h1>
        <p class="subtitle">æ‰¾åˆ°ä½ çš„æœ€ä½³æ”¶å…¥åŒºé—´ | 2025å¹´4æœˆèµ·é€‚ç”¨ç¨ç‡</p>

        <!-- å…³é”®æ´å¯Ÿå¡ç‰‡ -->
        <div class="insight-grid">
            <div class="insight-card green">
                <h3>$78,100 ä»¥ä¸‹</h3>
                <div class="insight-value">åˆ°æ‰‹ 68.4%+</div>
                <div class="insight-desc">è¾¹é™…ç¨ç‡ â‰¤30%<br>å« ACC åæ¯ $1 åˆ°æ‰‹ â‰¥$0.684</div>
            </div>
            <div class="insight-card blue">
                <h3>$78,101 - $180,000</h3>
                <div class="insight-value">åˆ°æ‰‹ 65.4%</div>
                <div class="insight-desc">è¾¹é™…ç¨ç‡ 33%<br>å« ACC åæ¯ $1 åˆ°æ‰‹ $0.654</div>
            </div>
            <div class="insight-card orange">
                <h3>$180,001+</h3>
                <div class="insight-value">åˆ°æ‰‹ 59.4%</div>
                <div class="insight-desc">è¾¹é™…ç¨ç‡ 39%<br>å« ACC åæ¯ $1 åˆ°æ‰‹ $0.594</div>
            </div>
        </div>

        <!-- è¾¹é™…æ”¶ç›Šç‡å›¾è¡¨ -->
        <div class="chart-card">
            <div class="chart-title">
                <span>ğŸ“ˆ</span> è¾¹é™…æ”¶ç›Šç‡ï¼ˆæ¯å¤šèµš $1 å®é™…åˆ°æ‰‹é‡‘é¢ï¼‰
            </div>
            <div class="chart-container">
                <canvas id="marginalChart"></canvas>
            </div>
        </div>

        <!-- æœ‰æ•ˆç¨ç‡å›¾è¡¨ -->
        <div class="chart-card">
            <div class="chart-title">
                <span>ğŸ“Š</span> æœ‰æ•ˆç¨ç‡ vs è¾¹é™…ç¨ç‡
            </div>
            <div class="chart-container">
                <canvas id="rateChart"></canvas>
            </div>
        </div>

        <!-- æ€§ä»·æ¯”åŒºé—´è¯¦è§£ -->
        <div class="sweet-zones">
            <h3>ğŸ’° æ”¶å…¥æ€§ä»·æ¯”åŒºé—´è¯¦è§£</h3>

            <div class="zone excellent">
                <div class="zone-indicator"></div>
                <div class="zone-content">
                    <div class="zone-header">
                        <span class="zone-range">$0 - $15,600</span>
                        <span class="zone-rate">åˆ°æ‰‹ 89.5%</span>
                    </div>
                    <div class="zone-detail">
                        <strong>æœ€ä½³æ€§ä»·æ¯”åŒºé—´ï¼</strong> è¾¹é™…ç¨ç‡ä»… 10.5%ã€‚åœ¨è¿™ä¸ªåŒºé—´å†…æ¯å¤šèµš $1ï¼Œå®é™…åˆ°æ‰‹ $0.895ã€‚
                        å¹´æ”¶å…¥ $15,600 æ—¶ï¼Œç¨ååˆ°æ‰‹ $13,962ï¼Œä»…ç¼´ç¨ $1,638ã€‚
                    </div>
                </div>
            </div>

            <div class="zone good">
                <div class="zone-indicator"></div>
                <div class="zone-content">
                    <div class="zone-header">
                        <span class="zone-range">$15,601 - $53,500</span>
                        <span class="zone-rate">åˆ°æ‰‹ 82.5%</span>
                    </div>
                    <div class="zone-detail">
                        <strong>æ€§ä»·æ¯”ä¾ç„¶ä¸é”™ã€‚</strong> è¾¹é™…ç¨ç‡ 17.5%ã€‚å¤§å¤šæ•°æ™®é€šå·¥è–ªæ”¶å…¥è½åœ¨è¿™ä¸ªåŒºé—´ã€‚
                        å¹´æ”¶å…¥ $53,500 æ—¶ï¼Œæœ‰æ•ˆç¨ç‡ä»… 15.46%ï¼Œç¨ååˆ°æ‰‹ $45,229.50ã€‚
                    </div>
                </div>
            </div>

            <div class="zone medium">
                <div class="zone-indicator"></div>
                <div class="zone-content">
                    <div class="zone-header">
                        <span class="zone-range">$53,501 - $78,100</span>
                        <span class="zone-rate">åˆ°æ‰‹ 70%</span>
                    </div>
                    <div class="zone-detail">
                        <strong>âš ï¸ ç¨ç‡è·³è·ƒåŒºï¼</strong> è¾¹é™…ç¨ç‡è·ƒå‡è‡³ 30%ã€‚è¿™æ˜¯å¢å¹…æœ€å¤§çš„ä¸€æ¡£ï¼ˆ+12.5%ï¼‰ã€‚
                        å¦‚æœæ”¶å…¥åˆšè¿‡ $53,500ï¼Œå¯è€ƒè™‘é€šè¿‡ KiwiSaver å¤šç¼´æ¥ä¼˜åŒ–ç¨åŠ¡ã€‚
                    </div>
                </div>
            </div>

            <div class="zone high">
                <div class="zone-indicator"></div>
                <div class="zone-content">
                    <div class="zone-header">
                        <span class="zone-range">$78,101 - $180,000</span>
                        <span class="zone-rate">åˆ°æ‰‹ 67%</span>
                    </div>
                    <div class="zone-detail">
                        è¾¹é™…ç¨ç‡ 33%ã€‚ä¸­é«˜æ”¶å…¥åŒºé—´ï¼Œä½†å¢å¹…ä»… 3%ï¼Œç›¸å¯¹å¹³ç¼“ã€‚
                        å¹´æ”¶å…¥ $100,000 æ—¶ï¼Œæœ‰æ•ˆç¨ç‡çº¦ 23.5%ï¼Œç¨ååˆ°æ‰‹ $76,530ã€‚
                    </div>
                </div>
            </div>

            <div class="zone highest">
                <div class="zone-indicator"></div>
                <div class="zone-content">
                    <div class="zone-header">
                        <span class="zone-range">$180,001+</span>
                        <span class="zone-rate">åˆ°æ‰‹ 61%</span>
                    </div>
                    <div class="zone-detail">
                        æœ€é«˜è¾¹é™…ç¨ç‡ 39%ã€‚é«˜æ”¶å…¥åŒºé—´ã€‚
                        å¹´æ”¶å…¥ $200,000 æ—¶ï¼Œæœ‰æ•ˆç¨ç‡çº¦ 29.4%ï¼Œç¨ååˆ°æ‰‹ $141,077.50ã€‚
                    </div>
                </div>
            </div>
        </div>

        <!-- å…³é”®å»ºè®® -->
        <div class="key-point">
            <h4>ğŸ’¡ å…³é”®å‘ç°</h4>
            <p>
                <strong>æœ€å¤§"æ€§ä»·æ¯”æ–­å´–"ï¼š</strong>å‘ç”Ÿåœ¨ $53,500 è¿™ä¸ªä¸´ç•Œç‚¹ã€‚è¶…è¿‡è¿™ä¸ªé‡‘é¢åï¼Œæ¯å¤šèµš $1 çš„åˆ°æ‰‹é‡‘é¢ä» $0.825 éª¤é™è‡³ $0.70ï¼Œé™å¹…è¾¾ 15%ã€‚<br><br>
                <strong>å®ç”¨å»ºè®®ï¼š</strong>å¦‚æœä½ çš„æ”¶å…¥åˆšå¥½è¶…è¿‡ $53,500 ä¸€ç‚¹ç‚¹ï¼ˆæ¯”å¦‚ $55,000-$60,000ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ï¼š
                1) å¢åŠ  KiwiSaver è´¡çŒ®ç‡ï¼›
                2) åˆç†çš„ç¨åŠ¡è§„åˆ’ï¼›
                3) æŠ•èµ„æŠµç¨é¡¹ç›®ã€‚
            </p>
        </div>

        <!-- 8ä¸‡-20ä¸‡è¯¦ç»†åˆ†æ -->
        <div class="sweet-zones" id="highIncomeAnalysis">
            <h3>ğŸ“Š $80,000 - $200,000 è¾¹é™…æ”¶ç›Šè¯¦ç»†åˆ†æ</h3>
            <p style="color: #666; margin-bottom: 20px;">ä»¥ä¸‹æ•°æ®åŒ…å«æ‰€å¾—ç¨ + ACC Levy (1.6%)ï¼Œå±•ç¤ºæ¯ä¸ªæ”¶å…¥æ°´å¹³çš„å®é™…åˆ°æ‰‹æƒ…å†µ</p>

            <table class="bracket-table" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <th style="padding: 12px; color: white; text-align: center;">ç¨å‰å¹´è–ª</th>
                        <th style="padding: 12px; color: white; text-align: center;">æ‰€å¾—ç¨</th>
                        <th style="padding: 12px; color: white; text-align: center;">ACC</th>
                        <th style="padding: 12px; color: white; text-align: center;">ç¨ååˆ°æ‰‹</th>
                        <th style="padding: 12px; color: white; text-align: center;">åˆ°æ‰‹æ¯”ä¾‹</th>
                        <th style="padding: 12px; color: white; text-align: center;">è¾¹é™…ç¨ç‡</th>
                        <th style="padding: 12px; color: white; text-align: center;">æ¯å¤šèµš$1åˆ°æ‰‹</th>
                    </tr>
                </thead>
                <tbody id="highIncomeTable">
                </tbody>
            </table>

            <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 12px;">
                <h4 style="color: #2e7d32; margin-bottom: 10px;">ğŸ’° $80k-$200k åŒºé—´å…³é”®æ´å¯Ÿ</h4>
                <ul style="color: #1b5e20; line-height: 2;">
                    <li><strong>$78,100 æ˜¯é‡è¦ä¸´ç•Œç‚¹</strong>ï¼šè¶…è¿‡åè¾¹é™…ç¨ç‡ä» 30% â†’ 33%ï¼Œæ¯ $1 åˆ°æ‰‹ä» $0.684 é™åˆ° $0.654</li>
                    <li><strong>$142,283 æ˜¯ ACC ä¸Šé™</strong>ï¼šè¶…è¿‡å ACC ä¸å†å¢åŠ ï¼Œè¾¹é™…æ‰£é™¤ç‡ç•¥é™</li>
                    <li><strong>$180,000 æ˜¯æœ€é«˜æ¡£èµ·ç‚¹</strong>ï¼šè¶…è¿‡åè¾¹é™…ç¨ç‡è·³åˆ° 39%ï¼Œæ¯ $1 åªåˆ°æ‰‹ $0.594</li>
                    <li><strong>$80k-$180k åŒºé—´ç›¸å¯¹å¹³ç¨³</strong>ï¼šè¾¹é™…ç¨ç‡ç¨³å®šåœ¨ 33%ï¼Œæ˜¯"æ€§ä»·æ¯”å¹³å°æœŸ"</li>
                </ul>
            </div>
        </div>

        <!-- è®¡ç®—å™¨ -->
        <div class="calculator">
            <h3>ğŸ§® ä¸ªäººç¨åŠ¡è®¡ç®—å™¨</h3>
            <div class="calc-input-group">
                <input type="number" id="incomeInput" placeholder="è¾“å…¥ä½ çš„ç¨å‰å¹´æ”¶å…¥ (NZD)">
                <button onclick="calculateTax()">è®¡ç®—æˆ‘çš„ç¨åŠ¡</button>
            </div>
            <div class="calc-result" id="calcResult">
                <div class="calc-result-grid">
                    <div class="calc-result-item">
                        <div class="calc-result-label">ç¨å‰å¹´æ”¶å…¥</div>
                        <div class="calc-result-value" id="resGross">-</div>
                    </div>
                    <div class="calc-result-item">
                        <div class="calc-result-label">ç¨ååˆ°æ‰‹</div>
                        <div class="calc-result-value green" id="resNet">-</div>
                    </div>
                    <div class="calc-result-item">
                        <div class="calc-result-label">æ‰€å¾—ç¨</div>
                        <div class="calc-result-value red" id="resTax">-</div>
                    </div>
                    <div class="calc-result-item">
                        <div class="calc-result-label">ACC (1.6%)</div>
                        <div class="calc-result-value red" id="resACC">-</div>
                    </div>
                    <div class="calc-result-item">
                        <div class="calc-result-label">æ€»æ‰£é™¤ç‡</div>
                        <div class="calc-result-value blue" id="resEffective">-</div>
                    </div>
                    <div class="calc-result-item">
                        <div class="calc-result-label">è¾¹é™…ç¨ç‡</div>
                        <div class="calc-result-value" id="resMarginal">-</div>
                    </div>
                    <div class="calc-result-item">
                        <div class="calc-result-label">æ¯å¤šèµš$1åˆ°æ‰‹</div>
                        <div class="calc-result-value green" id="resMarginalNet">-</div>
                    </div>
                </div>
                <div class="comparison-bar">
                    <div class="bar-label">
                        <span>æ”¶å…¥åˆ†é…</span>
                        <span id="barLabels">-</span>
                    </div>
                    <div class="bar-container">
                        <div class="bar-net" id="barNet" style="width: 80%;">åˆ°æ‰‹</div>
                        <div class="bar-tax" id="barTax" style="width: 20%;">ç¨</div>
                    </div>
                </div>
                <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; text-align: center;">
                    <div>
                        <div style="color: #666; font-size: 12px;">æ¯æœˆåˆ°æ‰‹</div>
                        <div style="font-size: 20px; font-weight: 600; color: #10b981;" id="resMonthly">-</div>
                    </div>
                    <div>
                        <div style="color: #666; font-size: 12px;">æ¯å‘¨åˆ°æ‰‹</div>
                        <div style="font-size: 20px; font-weight: 600; color: #10b981;" id="resWeekly">-</div>
                    </div>
                </div>
            </div>
        </div>

        <p class="source">
            æ•°æ®æ¥æºï¼š<a href="https://www.ird.govt.nz/income-tax/income-tax-for-individuals/tax-codes-and-tax-rates-for-individuals/tax-rates-for-individuals" target="_blank">æ–°è¥¿å…°ç¨åŠ¡å±€ (IRD) å®˜æ–¹ç½‘ç«™</a> | 2025å¹´4æœˆ1æ—¥èµ·é€‚ç”¨
        </p>
    </div>

    <script>
        // ç¨ç‡é…ç½® (2025å¹´4æœˆèµ·)
        const taxBrackets = [
            { min: 0, max: 15600, rate: 0.105 },
            { min: 15600, max: 53500, rate: 0.175 },
            { min: 53500, max: 78100, rate: 0.30 },
            { min: 78100, max: 180000, rate: 0.33 },
            { min: 180000, max: Infinity, rate: 0.39 }
        ];

        // ACC Earners' Levy (2024/2025: 1.60%, ä¸Šé™æ”¶å…¥ $142,283)
        const ACC_RATE = 0.016;
        const ACC_MAX_INCOME = 142283;

        function calculateTaxForIncome(grossIncome) {
            let tax = 0;
            let remainingIncome = grossIncome;

            for (const bracket of taxBrackets) {
                if (remainingIncome <= 0) break;
                const taxableInBracket = Math.min(remainingIncome, bracket.max - bracket.min);
                tax += taxableInBracket * bracket.rate;
                remainingIncome -= taxableInBracket;
            }
            return tax;
        }

        function calculateACC(grossIncome) {
            const accableIncome = Math.min(grossIncome, ACC_MAX_INCOME);
            return accableIncome * ACC_RATE;
        }

        function getMarginalRate(income) {
            for (const bracket of taxBrackets) {
                if (income <= bracket.max) return bracket.rate;
            }
            return taxBrackets[taxBrackets.length - 1].rate;
        }

        function getEffectiveRate(income) {
            if (income === 0) return 0;
            return calculateTaxForIncome(income) / income;
        }

        // ç”Ÿæˆå›¾è¡¨æ•°æ®
        const incomePoints = [];
        const marginalRetention = [];
        const effectiveRates = [];
        const marginalRates = [];
        const chartLabels = [];

        for (let income = 0; income <= 250000; income += 5000) {
            incomePoints.push(income);
            const margRate = getMarginalRate(income);
            marginalRetention.push((1 - margRate) * 100);
            effectiveRates.push(getEffectiveRate(income) * 100);
            marginalRates.push(margRate * 100);
            // æ¯ 50k æ˜¾ç¤ºä¸€ä¸ªæ ‡ç­¾
            if (income % 50000 === 0) {
                chartLabels.push('$' + (income/1000) + 'k');
            } else {
                chartLabels.push('');
            }
        }

        // è¾¹é™…æ”¶ç›Šç‡å›¾è¡¨
        const marginalCtx = document.getElementById('marginalChart').getContext('2d');
        new Chart(marginalCtx, {
            type: 'line',
            data: {
                labels: chartLabels,
                datasets: [{
                    label: 'è¾¹é™…æ”¶ç›Šç‡ %',
                    data: marginalRetention,
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    stepped: true,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            title: (ctx) => `å¹´æ”¶å…¥: $${incomePoints[ctx[0].dataIndex].toLocaleString()}`,
                            label: (ctx) => `æ¯å¤šèµš $1 åˆ°æ‰‹: $${(ctx.raw / 100).toFixed(3)}`
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'ç¨å‰å¹´æ”¶å…¥ (NZD)', font: { weight: 'bold' } },
                        ticks: {
                            maxRotation: 0,
                            autoSkip: false
                        }
                    },
                    y: {
                        title: { display: true, text: 'æ¯èµš $1 åˆ°æ‰‹æ¯”ä¾‹ (%)', font: { weight: 'bold' } },
                        min: 55,
                        max: 95,
                        ticks: { callback: v => v + '%' }
                    }
                }
            }
        });

        // ç¨ç‡å¯¹æ¯”å›¾è¡¨
        const rateCtx = document.getElementById('rateChart').getContext('2d');
        new Chart(rateCtx, {
            type: 'line',
            data: {
                labels: chartLabels,
                datasets: [
                    {
                        label: 'æœ‰æ•ˆç¨ç‡',
                        data: effectiveRates,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0
                    },
                    {
                        label: 'è¾¹é™…ç¨ç‡',
                        data: marginalRates,
                        borderColor: '#ef4444',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        stepped: true,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: { usePointStyle: true }
                    },
                    tooltip: {
                        callbacks: {
                            title: (ctx) => `å¹´æ”¶å…¥: $${incomePoints[ctx[0].dataIndex].toLocaleString()}`,
                            label: (ctx) => `${ctx.dataset.label}: ${ctx.raw.toFixed(1)}%`
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'ç¨å‰å¹´æ”¶å…¥ (NZD)', font: { weight: 'bold' } },
                        ticks: {
                            maxRotation: 0,
                            autoSkip: false
                        }
                    },
                    y: {
                        title: { display: true, text: 'ç¨ç‡ (%)', font: { weight: 'bold' } },
                        min: 0,
                        max: 45,
                        ticks: { callback: v => v + '%' }
                    }
                }
            }
        });

        // è®¡ç®—å™¨
        function calculateTax() {
            const income = parseFloat(document.getElementById('incomeInput').value);
            if (isNaN(income) || income < 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ”¶å…¥é‡‘é¢');
                return;
            }

            const incomeTax = calculateTaxForIncome(income);
            const accLevy = calculateACC(income);
            const totalDeductions = incomeTax + accLevy;
            const netIncome = income - totalDeductions;
            const effectiveRate = (totalDeductions / income) * 100;
            const marginalRate = getMarginalRate(income) * 100;
            const marginalNet = 1 - getMarginalRate(income) - ACC_RATE;

            document.getElementById('resGross').textContent = '$' + income.toLocaleString();
            document.getElementById('resNet').textContent = '$' + netIncome.toLocaleString(undefined, {maximumFractionDigits: 2});
            document.getElementById('resTax').textContent = '$' + incomeTax.toLocaleString(undefined, {maximumFractionDigits: 2});
            document.getElementById('resACC').textContent = '$' + accLevy.toLocaleString(undefined, {maximumFractionDigits: 2});
            document.getElementById('resEffective').textContent = effectiveRate.toFixed(1) + '%';
            document.getElementById('resMarginal').textContent = marginalRate + '%';
            document.getElementById('resMarginalNet').textContent = '$' + marginalNet.toFixed(3);
            document.getElementById('resMonthly').textContent = '$' + (netIncome / 12).toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('resWeekly').textContent = '$' + (netIncome / 52).toLocaleString(undefined, {maximumFractionDigits: 0});

            const netPercent = (netIncome / income) * 100;
            const deductPercent = (totalDeductions / income) * 100;
            document.getElementById('barNet').style.width = netPercent + '%';
            document.getElementById('barNet').textContent = 'åˆ°æ‰‹ ' + netPercent.toFixed(0) + '%';
            document.getElementById('barTax').style.width = deductPercent + '%';
            document.getElementById('barTax').textContent = 'æ‰£é™¤ ' + deductPercent.toFixed(0) + '%';
            document.getElementById('barLabels').textContent = `åˆ°æ‰‹ $${netIncome.toLocaleString(undefined, {maximumFractionDigits: 0})} | æ‰£é™¤ $${totalDeductions.toLocaleString(undefined, {maximumFractionDigits: 0})}`;

            document.getElementById('calcResult').style.display = 'block';
        }

        document.getElementById('incomeInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calculateTax();
        });

        // ç”Ÿæˆ $80k-$200k è¯¦ç»†è¡¨æ ¼
        function generateHighIncomeTable() {
            const incomes = [80000, 90000, 100000, 110000, 120000, 130000, 140000, 142283, 150000, 160000, 170000, 180000, 190000, 200000];
            const tbody = document.getElementById('highIncomeTable');

            incomes.forEach((income, index) => {
                const incomeTax = calculateTaxForIncome(income);
                const acc = calculateACC(income);
                const totalDeduct = incomeTax + acc;
                const netIncome = income - totalDeduct;
                const takeHomePercent = ((netIncome / income) * 100).toFixed(1);
                const margRate = getMarginalRate(income) * 100;

                // è®¡ç®—è¾¹é™…åˆ°æ‰‹ï¼ˆå«ACCï¼‰
                let marginalNet;
                if (income > ACC_MAX_INCOME) {
                    marginalNet = (1 - getMarginalRate(income)).toFixed(3); // ACCå·²åˆ°ä¸Šé™
                } else {
                    marginalNet = (1 - getMarginalRate(income) - ACC_RATE).toFixed(3);
                }

                // é«˜äº®å…³é”®è¡Œ
                let rowStyle = '';
                let highlight = '';
                if (income === 142283) {
                    rowStyle = 'background: #fff3cd;';
                    highlight = ' âš¡ ACCä¸Šé™';
                } else if (income === 180000) {
                    rowStyle = 'background: #ffebee;';
                    highlight = ' âš ï¸ 39%èµ·ç‚¹';
                }

                const row = document.createElement('tr');
                row.style.cssText = rowStyle;
                row.innerHTML = `
                    <td style="padding: 12px; text-align: center; font-weight: 600;">$${income.toLocaleString()}${highlight}</td>
                    <td style="padding: 12px; text-align: center; color: #e53935;">$${incomeTax.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                    <td style="padding: 12px; text-align: center; color: #e53935;">$${acc.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                    <td style="padding: 12px; text-align: center; color: #43a047; font-weight: 600;">$${netIncome.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                    <td style="padding: 12px; text-align: center; color: #1976d2;">${takeHomePercent}%</td>
                    <td style="padding: 12px; text-align: center;">${margRate}%</td>
                    <td style="padding: 12px; text-align: center; color: #43a047; font-weight: 600;">$${marginalNet}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆè¡¨æ ¼
        generateHighIncomeTable();
    </script>
</body>
</html>
